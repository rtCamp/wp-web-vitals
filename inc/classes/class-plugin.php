<?php
/**
 * Main plugin class.
 *
 * @author  Dhaval Parekh <dmparekh007@gmail.com>
 *
 * @package wp-web-vitals
 */

namespace WP_Web_Vitals\Inc;

use WP_Web_Vitals\Inc\Traits\Singleton;

/**
 * Class Plugin
 */
class Plugin {

	use Singleton;

	/**
	 * Plugin constructor.
	 */
	protected function __construct() {
		$this->setup_hooks();
	}

	/**
	 * To setup actions/filters.
	 *
	 * @return void
	 */
	protected function setup_hooks() {
		/**
		 * Actions
		 */
		add_action( 'admin_bar_menu', array( $this, 'add_admin_bar_menu_items' ) );
		add_action( 'wp_enqueue_scripts', array( $this, 'web_vitals_enqueue_scripts' ), 1 );
		add_action( 'wp_head', array( $this, 'web_vitals_enqueue_styles' ), 1 );
	}

	/**
	 * To enqueue script for web vitals.
	 *
	 * @return void
	 */
	public function web_vitals_enqueue_scripts() {
		wp_enqueue_script( 'wp_web_vital_script', sprintf( '%s/assets/js/script.js', WP_WEB_VITALS_URL ), array( 'jquery' ), WP_WEB_VITALS_VERSION, false );
	}

	/**
	 * To enqueue style for web vitals.
	 *
	 * @return void
	 */
	public function web_vitals_enqueue_styles() {
		wp_register_style( 'wp_web_vital_style', sprintf( '%s/assets/css/style.css', WP_WEB_VITALS_URL ), array(), WP_WEB_VITALS_VERSION );
		wp_enqueue_style( 'wp_web_vital_style' );
	}

	/**
	 * Add menu items to admin bar for Web Vitals.
	 *
	 */
	public function add_admin_bar_menu_items() {
		global $wp_admin_bar;

		if ( is_admin() ) {
			return;
		}

		$node = array(
			'id'     => 'wp_web_vitals',
			'parent' => 'top-secondary',
			'title'  => '<span class="ab-icon"><?xml version="1.0" encoding="UTF-8"?><svg id="web_vitals_icon" width="60px" height="32px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="88.46153846153847" viewBox="0, 0, 400,88.46153846153847"><g id="svgg"><path id="path0" d="M372.917 3.833 C 372.733 3.912,371.617 3.982,370.436 3.988 L 368.288 4.000 368.728 4.345 L 369.167 4.691 369.164 12.554 C 369.161 21.586,369.195 21.366,367.667 22.120 L 366.917 22.490 350.083 22.510 C 336.301 22.526,332.933 22.574,331.500 22.773 C 330.014 22.980,325.092 23.016,298.833 23.008 C 262.805 22.998,266.217 22.776,265.580 25.172 C 265.273 26.324,265.219 38.853,265.516 39.822 C 266.410 42.731,264.171 42.535,295.250 42.433 C 311.751 42.379,322.472 42.413,326.000 42.531 C 330.623 42.685,340.620 42.853,344.833 42.847 C 345.521 42.846,348.033 42.841,350.417 42.835 C 357.854 42.817,357.492 42.355,357.545 51.926 C 357.600 61.695,358.203 61.023,349.417 60.986 C 335.858 60.930,326.664 60.998,322.849 61.184 C 319.792 61.332,296.589 61.387,231.583 61.400 C 146.818 61.416,144.397 61.425,143.703 61.728 C 142.381 62.306,142.326 62.696,142.247 72.167 L 142.181 79.917 141.653 80.290 L 141.124 80.662 231.640 80.666 C 291.513 80.668,322.568 80.726,323.370 80.837 C 324.154 80.945,333.733 80.989,350.428 80.961 L 376.272 80.917 376.702 80.453 C 377.334 79.770,377.326 80.261,377.323 43.000 C 377.320 4.183,377.331 4.787,376.628 4.131 C 376.106 3.643,373.792 3.457,372.917 3.833 M376.188 4.776 C 376.520 5.175,376.532 79.535,376.200 79.867 C 375.809 80.258,323.774 80.178,323.381 79.786 C 322.923 79.328,322.830 64.380,323.277 63.136 C 323.801 61.679,322.179 61.813,340.112 61.750 C 349.503 61.717,357.148 61.618,358.667 61.509 C 360.087 61.408,362.412 61.332,363.833 61.340 C 368.372 61.367,368.270 61.376,368.741 60.939 L 369.167 60.545 369.161 51.898 C 369.156 42.823,369.163 42.911,368.417 42.583 C 368.233 42.502,366.133 42.425,363.750 42.411 C 361.367 42.397,358.179 42.300,356.667 42.194 C 355.027 42.080,349.611 42.004,343.250 42.006 C 337.383 42.007,332.330 41.958,332.021 41.896 C 330.913 41.674,330.872 41.391,330.777 33.250 C 330.686 25.455,330.753 24.540,331.461 23.792 L 331.896 23.333 349.651 23.333 C 369.491 23.333,371.773 23.254,372.542 22.534 L 373.000 22.104 373.000 13.990 C 373.000 5.257,373.018 4.958,373.559 4.696 C 374.163 4.403,375.923 4.457,376.188 4.776 " stroke="none" fill="#dd8e30" fill-rule="evenodd"></path><path id="path1" d="M373.559 4.696 C 373.018 4.958,373.000 5.257,373.000 13.990 L 373.000 22.104 372.542 22.534 C 371.773 23.254,369.491 23.333,349.651 23.333 L 331.896 23.333 331.461 23.792 C 330.753 24.540,330.686 25.455,330.777 33.250 C 330.872 41.391,330.913 41.674,332.021 41.896 C 332.330 41.958,337.383 42.007,343.250 42.006 C 349.611 42.004,355.027 42.080,356.667 42.194 C 358.179 42.300,361.367 42.397,363.750 42.411 C 366.133 42.425,368.233 42.502,368.417 42.583 C 369.163 42.911,369.156 42.823,369.161 51.898 L 369.167 60.545 368.741 60.939 C 368.270 61.376,368.372 61.367,363.833 61.340 C 362.412 61.332,360.087 61.408,358.667 61.509 C 357.148 61.618,349.503 61.717,340.112 61.750 C 322.179 61.813,323.801 61.679,323.277 63.136 C 322.830 64.380,322.923 79.328,323.381 79.786 C 323.774 80.178,375.809 80.258,376.200 79.867 C 376.532 79.535,376.520 5.175,376.188 4.776 C 375.923 4.457,374.163 4.403,373.559 4.696 " stroke="none" fill="#db201b" fill-rule="evenodd"></path><path id="path2" d="M15.901 4.351 C 15.591 4.693,15.582 5.591,15.541 42.237 L 15.498 79.773 15.929 80.178 L 16.360 80.583 78.738 80.626 L 141.115 80.668 141.648 80.292 L 142.181 79.917 142.247 72.167 C 142.326 62.696,142.381 62.306,143.703 61.728 C 144.397 61.425,146.818 61.416,231.583 61.400 C 296.589 61.387,319.792 61.332,322.849 61.184 C 326.664 60.998,335.858 60.930,349.417 60.986 C 358.203 61.023,357.600 61.695,357.545 51.926 C 357.492 42.355,357.854 42.817,350.417 42.835 C 348.033 42.841,345.521 42.846,344.833 42.847 C 340.620 42.853,330.623 42.685,326.000 42.531 C 322.472 42.413,311.751 42.379,295.250 42.433 C 264.171 42.535,266.410 42.731,265.516 39.822 C 265.219 38.853,265.273 26.324,265.580 25.172 C 266.217 22.776,262.805 22.998,298.833 23.008 C 325.092 23.016,330.014 22.980,331.500 22.773 C 332.933 22.574,336.301 22.526,350.083 22.510 L 366.917 22.490 367.667 22.120 C 369.195 21.366,369.161 21.586,369.164 12.554 L 369.167 4.691 368.728 4.345 L 368.288 4.000 192.253 4.000 L 16.218 4.000 15.901 4.351 " stroke="none" fill="#4db14b" fill-rule="evenodd"></path><path id="path3" d="M0.000 44.167 L 0.000 88.333 200.000 88.333 L 400.000 88.333 400.000 44.167 L 400.000 0.000 200.000 0.000 L 0.000 0.000 0.000 44.167 M376.167 2.749 C 376.579 2.880,377.123 3.030,377.375 3.081 C 377.716 3.149,377.833 3.272,377.833 3.558 C 377.833 3.769,378.016 4.393,378.240 4.943 C 378.612 5.859,378.657 6.261,378.767 9.680 C 378.904 13.939,378.910 13.532,378.668 17.167 C 378.477 20.025,378.473 20.682,378.483 45.583 C 378.487 55.160,378.426 61.119,378.319 61.750 C 378.190 62.511,378.211 63.220,378.408 64.717 C 378.600 66.176,378.667 68.204,378.667 72.571 C 378.667 78.856,378.636 79.292,378.148 79.815 C 377.964 80.013,377.833 80.395,377.833 80.737 C 377.833 81.370,377.503 81.667,376.798 81.667 C 376.583 81.667,376.260 81.769,376.079 81.893 C 375.392 82.366,377.012 82.345,325.686 82.527 C 324.375 82.531,323.086 82.261,322.652 81.890 C 322.430 81.700,308.041 81.658,233.485 81.630 C 58.999 81.562,15.389 81.460,15.048 81.119 C 14.567 80.638,14.586 4.050,15.067 3.518 L 15.384 3.168 192.567 3.099 C 357.141 3.035,371.972 3.004,372.667 2.716 C 372.804 2.659,372.967 2.606,373.028 2.598 C 373.089 2.590,373.190 2.533,373.252 2.471 C 373.424 2.298,375.323 2.479,376.167 2.749 " stroke="none" fill="#fafbf9" fill-rule="evenodd"></path><path id="path4" d="M373.252 2.471 C 373.190 2.533,373.089 2.590,373.028 2.598 C 372.967 2.606,372.804 2.659,372.667 2.716 C 371.972 3.004,357.141 3.035,192.567 3.099 L 15.384 3.168 15.067 3.518 C 14.586 4.050,14.567 80.638,15.048 81.119 C 15.389 81.460,58.999 81.562,233.485 81.630 C 308.041 81.658,322.430 81.700,322.652 81.890 C 323.086 82.261,324.375 82.531,325.686 82.527 C 377.012 82.345,375.392 82.366,376.079 81.893 C 376.260 81.769,376.583 81.667,376.798 81.667 C 377.503 81.667,377.833 81.370,377.833 80.737 C 377.833 80.395,377.964 80.013,378.148 79.815 C 378.636 79.292,378.667 78.856,378.667 72.571 C 378.667 68.204,378.600 66.176,378.408 64.717 C 378.211 63.220,378.190 62.511,378.319 61.750 C 378.426 61.119,378.487 55.160,378.483 45.583 C 378.473 20.682,378.477 20.025,378.668 17.167 C 378.910 13.532,378.904 13.939,378.767 9.680 C 378.657 6.261,378.612 5.859,378.240 4.943 C 378.016 4.393,377.833 3.769,377.833 3.558 C 377.833 3.272,377.716 3.149,377.375 3.081 C 377.123 3.030,376.579 2.880,376.167 2.749 C 375.323 2.479,373.424 2.298,373.252 2.471 M376.628 4.131 C 377.331 4.787,377.320 4.183,377.323 43.000 C 377.326 80.261,377.334 79.770,376.702 80.453 L 376.272 80.917 350.844 80.970 C 332.747 81.008,324.816 80.969,323.333 80.834 C 321.795 80.694,281.349 80.636,168.805 80.614 L 16.360 80.583 15.929 80.178 L 15.498 79.773 15.541 42.237 C 15.582 5.591,15.591 4.693,15.901 4.351 L 16.218 4.000 194.401 3.988 C 293.360 3.982,372.732 3.913,372.917 3.833 C 373.792 3.457,376.106 3.643,376.628 4.131 " stroke="none" fill="#fcecf1" fill-rule="evenodd"></path></g></svg></span>',
			'href'   => '#',
		);

		$wp_admin_bar->add_node( $node );
	}

}
